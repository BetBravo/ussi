{% extends 'base.html.twig' %}
{% block stylesheets %}
    <!-- sweetalert2 -->
    <script src="{{ asset('bundles/app/vendors/sweetalert2/sweetalert2.min.js')}}"></script>
    <link href="{{ asset('bundles/app/vendors/sweetalert2/sweetalert2.min.css')}}" rel="stylesheet">
{% endblock %}
{% block body %}
    <div class="x_content">
        <h1>Cita consulta</h1>
        <h2>Servicios Disponibles</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Especialidad</th>
                    <th>Día</th>
                    <th>Turno</th>
                    <th>Procedencia</th>
                    <th>Cupos</th> 
                    <th>Disponibles</th>
                    <th>Preferencia</th>
                </tr>
            </thead>
            <tbody>
                {% for servicio in servicios %}
                    <tr>
                        <td><a href="{{ path('servicio_show', { 'id': servicio.id }) }}">{{ servicio.id }}</a></td>
                        <td id='n-e-{{ loop.index}}'>{{ servicio.nombre }}</td>
                        <td>
                            {% set dia = ['Domingo','Lunes','Martes','Miércoles','Jueves','Viernes','Sábado'] %}
                            {{ dia[servicio.dia] }}
                        </td>
                        <td>{{ servicio.turno | title }}</td>
                        <td>{{ servicio.procedencia }}</td>
                        <td>{{ servicio.cupo }}</td>          
                        <td>{{ servicio.disponible }}</td>
                        <td> {% if servicio.disponible >0%} 
                            <button class="btn btn-success btn-especialidad" id="e-{{ loop.index}}">Seleccionar</button>
                        {% else%} 
                            <button class="btn btn-danger">No Disponible</button>
                            {% endif%}
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>




                    <br>
                           

                </div>

                <!-- Large modal -->
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">Large modal</button>

                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                            </div>
                            <div class="modal-body">
                                {{ form_start(form, { 'attr': {'id':'paciente','class': 'form-horizontal form-label-left'} }) }} 
                    {{ form_errors(form) }}
                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="nacionalidad">{{ form_label(form.nacionalidad) }} <span class="required">*</span></label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            {{ form_errors(form.nacionalidad) }}                
                            {{form_widget(form.nacionalidad,{ 'attr': {'class': 'form-control col-md-7 col-xs-12'} } ) }}                
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="cedula">{{ form_label(form.cedula) }} <span class="required">*</span></label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            {{ form_errors(form.cedula) }}                
                            {{form_widget(form.cedula,{ 'attr': {'class': 'form-control col-md-7 col-xs-12'} } ) }}                
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="especialidad">{{ form_label(form.especialidad) }} <span class="required">*</span></label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            {{ form_errors(form.especialidad) }}                
                            {{form_widget(form.especialidad,{ 'attr': {'class': 'form-control col-md-7 col-xs-12'} } ) }}                
                        </div>
                    </div>

                    <div class="form-group medico">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="especialidad">Medico  <span class="required">*</span></label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            {{ form_errors(form.medico) }}                
                            {{form_widget(form.medico,{ 'attr': {'class': 'form-control col-md-7 col-xs-12'} } ) }}                
                        </div>
                    </div>

                    <div class="ln_solid"></div>
                    <div class="form-group">
                        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">                
                            <button id='miBoton' class="btn btn-success">Registrar</button>
                        </div>
                    </div>



                    {{ form_end(form) }} 
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary">Save changes</button>
                            </div>

                        </div>
                    </div>
                </div>


                {% endblock %}

                    {% block javascripts %}
                        <script>
                                    $(document).ready(function () {
                            $("#paciente").hide();
                                    $("#form_medico").val("False");
                                    $(".medico").hide();
                                    $(".btn-especialidad").click(function () {
                            $("#paciente").show();
                                    $('#form_especialidad').val($("#n-" + $(this).prop('id')).html());
                            });
                                    $("#miBoton").click(function () {

                            $("#paciente").submit();
                            });
                                    if (( {% if (profesionalDisponible!=null and profesionalDisponible.status=='inactivo')  %} 1 {% else %} 0{% endif %}) == 1) {
                            //swal('Oops...', 'Doctor No Disponible', 'error').catch(swal.noop)                
                            swal({
                            title: 'Cita - Dr. No Disponible',
                                    text: "Dr. {{doctor}} - {{observacion}} ",
                                    type: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Otro Doctor!',
                                    cancelButtonText: 'Cancelar!',
                                    confirmButtonClass: 'btn btn-success',
                                    cancelButtonClass: 'btn btn-danger',
                                    buttonsStyling: false
                            }).then(function () {

                            $("#form_medico").val("Verdad");
                                    $("#paciente").submit();
                            }, function (dismiss) {
                            // dismiss can be 'cancel', 'overlay',
                            // 'close', and 'timer'
                            if (dismiss === 'cancel') {
                            window.location.href = "consulta";
                            }
                            })
                            }
                            if (( {% if (maximoConsulta!=null)  %} 1 {% else %} 0{% endif %}) == 1) {
                            swal('Oops...', '{{maximoConsulta}}', 'error').catch(swal.noop)
                                    $('#form_cedula').val(' ');
                            }

                            if (( {% if (cola!=null)  %} 1 {% else %} 0{% endif %}) == 1) {
                            swal('Oops...', 'Usted tiene {{cola - 1}} personas por delante', 'success').catch(swal.noop);
                                    $('#form_cedula').val(' ');
                            }
                            });
                        </script>
                        <!-- /Datatables -->
                    {% endblock %}